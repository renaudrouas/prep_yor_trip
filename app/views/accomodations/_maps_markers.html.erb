<%= render 'shared/map_big' %>

<script>

  function initMap() {
const mapElement = document.getElementById('map');
if (mapElement) { // don't try to build a map if there's no div#map to inject in
  var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 43.2944947, lng: 5.3727672},
          zoom: 13
        });
  const markers = JSON.parse(mapElement.dataset.markers);
  markers.forEach(function(marker) {
    let new_marker = map.addMarker(marker);
    new_marker.addListener('click', function() {
      console.log("click on marker");
      window.location.pathname = "accomodations/" + marker.id;
    });
  });


  // map.addMarkers(markers);
  if (markers.length === 0) {
    map.setZoom(2);
  } else if (markers.length === 1) {
    map.setCenter(markers[0].lat, markers[0].lng);
    map.setZoom(14);
  } else {
    map.fitLatLngBounds(markers);
  }
}
}
 </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvdATWDXEuY1SASpXpkOW8fC8sm9Q7hHE&libraries=places&callback=initMap"
    async defer></script>
